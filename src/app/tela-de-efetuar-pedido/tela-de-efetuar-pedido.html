<section>

    <div class="input-fields">
        <mat-form-field>
            <mat-label>Categoria</mat-label>
            <mat-select
                name="grupo"
                [(ngModel)]="grupoSelecionado" 
                (selectionChange)="onGrupoSelecionado()">
                @for (grupo of grupos; track grupo.id) {
                    <mat-option [value]="grupo">
                        {{ grupo.nome }}
                    </mat-option>
                }
            </mat-select>
        </mat-form-field>

        <mat-form-field>
            <mat-label>Material</mat-label>
            <mat-select
                name="material"
                [(ngModel)]="materialSelecionado"
                (selectionChange)="onMaterialSelecionado()">
                @for (material of materiaisProGrupo; track material.id) {
                    <mat-option [value]="material">
                        {{ material.nome }}
                    </mat-option>
                }
            </mat-select>
        </mat-form-field>
    </div>

    @if (materialSelecionado) {
        <mat-card>
            <img mat-card-image [src]="imagem">
            <mat-card-content>
                <p><b>Produto:</b> {{ materialSelecionado.nome }}</p>
                <hr>
                <p><b>Valor unitário :</b> {{ materialSelecionado.preco | currency:'BRL'}}</p>
                <hr>
                <p><b>Disponível em estoque:</b> {{ materialSelecionado.quantidadeEmEstoque }}</p>
                <hr>
            </mat-card-content>
            <mat-card-actions>
                <mat-form-field>
                    <mat-label>Quantidade</mat-label>
                    <input matInput
                        type="number" 
                        name="quantidade"
                        [(ngModel)]="quantidadeInput"
                        placeholder="0" inputmode="numeric">
                </mat-form-field>
                <button matButton="elevated" (click)="adicionar()">Adicionar</button>
            </mat-card-actions>
        </mat-card>
    }

    @if (itensDoPedido.length > 0) {
        <table mat-table [dataSource]="itensDoPedido" >
            <ng-container matColumnDef="produto">
                <th mat-header-cell *matHeaderCellDef> Produto </th>
                <td mat-cell *matCellDef="let item"> {{ item.nome }} </td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>

            <ng-container matColumnDef="quantidade">
                <th mat-header-cell *matHeaderCellDef> Quantidade </th>
                <td mat-cell *matCellDef="let item"> {{ item.quantidade }} </td>
                <td mat-footer-cell *matFooterCellDef><b>Valor total:</b></td>
            </ng-container>

            <ng-container matColumnDef="valor">
                <th mat-header-cell *matHeaderCellDef> Valor </th>
                <td mat-cell *matCellDef="let item"> {{ item.valorTotal | currency:'BRL'}} </td>
                <td mat-footer-cell *matFooterCellDef><b> {{getTotalCost() | currency}} </b></td>
            </ng-container>

            <ng-container matColumnDef="remover">
                <th mat-header-cell *matHeaderCellDef></th>

                <td mat-cell *matCellDef="let item"><a matIconButton (click)="removerItem(item)"><mat-icon>delete</mat-icon></a></td>
                <td mat-footer-cell *matFooterCellDef></td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
            <tr mat-footer-row *matFooterRowDef="displayedColumns"></tr>
        </table>

        <mat-form-field>
            <mat-label>Nome</mat-label>
            <input matInput
                type="text" 
                name="nome"
                [(ngModel)]="nome">
        </mat-form-field>

        <mat-form-field>
            <mat-label>Telefone</mat-label>
            <input matInput
                type="text" 
                name="telefone"
                [(ngModel)]="telefone">
        </mat-form-field>

        <button matButton="filled" (click)="finalizarPedido()">
            <mat-icon>forum</mat-icon>
            Finalizar pedido
        </button>

    }
    
    
</section>
<a #tabelaDeItens></a> 